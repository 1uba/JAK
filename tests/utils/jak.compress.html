<html>
	<head>
		<script language="JavaScript" src="../../jsunit/app/jsUnitCore.js"></script>
		<script language="JavaScript" src="../../lib/jak.js"></script>
		<script language="JavaScript" src="../../util/compress.js?1"></script>
		<script language="JavaScript">
		
		function createTestData(min, max) {
			var arr = [];
			for (var i=min;i<max;i++) { arr.push(String.fromCharCode(i)); }

			var result = "";
			for (var i=0;i<3;i++) { result += arr.join(""); }
			return result;
		}
		
		function testStringsBytes() {
			var s = "ahoj";
			var b = JAK.Compress.stringToBytes(s);
			assertEquals('string -> pole bajtu', b.join(","), "97,104,111,106");
			var s2 = JAK.Compress.bytesToString(b);
			assertEquals('pole bajtu -> string', s, s2);
		}
		
		function testStringsUTF8() {
			var s = "žšč";
			var b = JAK.Compress.stringToBytes(s);
			var s2 = JAK.Compress.bytesToString(b);
			assertEquals('utf8 string -> pole bajtu -> string', s, s2);
			assertEquals('pocet utf8 bajtu', b.length, 6);
		}

		function testMTF() {
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var mtf = JAK.Compress.MTF(bytes);
			var imtf = JAK.Compress.iMTF(mtf);
			var result = JAK.Compress.bytesToString(imtf);
			assertEquals("MTF", data, result);
			
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			JAK.Compress.MTF(bytes, {inPlace:true});
			JAK.Compress.iMTF(bytes, {inPlace:true});
			var result = JAK.Compress.bytesToString(bytes);
			assertEquals("MTF in place", data, result);
		}

		function testBWT() {
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			try {
				JAK.Compress.BWT(bytes);
				fail("BWT must fail if mark is present");
			} catch (e) {
			}
			
			var data = createTestData(1, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var bwt = JAK.Compress.BWT(bytes);
			var ibwt = JAK.Compress.iBWT(bwt);
			var result = JAK.Compress.bytesToString(ibwt);
			assertEquals("BWT", data, result);
			
			var data = createTestData(0, 255);
			var bytes = JAK.Compress.stringToBytes(data);
			var bwt = JAK.Compress.BWT(bytes, {mark:255});
			var ibwt = JAK.Compress.iBWT(bwt, {mark:255});
			var result = JAK.Compress.bytesToString(ibwt);
			assertEquals("BWT with 255 mark", data, result);
		}
		
		function testRLE() {
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var rle = JAK.Compress.RLE(bytes);
			var irle = JAK.Compress.iRLE(rle);
			var result = JAK.Compress.bytesToString(irle);
			assertEquals("RLE", data, result);
		}

		function testLZW() {
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var lzw = JAK.Compress.LZW(bytes);
			var ilzw = JAK.Compress.iLZW(lzw);
			var result = JAK.Compress.bytesToString(ilzw);
			assertEquals("LZW", data, result);
			
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var lzw = JAK.Compress.LZW(bytes, {fixedWidth:true});
			var ilzw = JAK.Compress.iLZW(lzw, {fixedWidth:true});
			var result = JAK.Compress.bytesToString(ilzw);
			assertEquals("LZW with fixed-width output", data, result);
			
			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var lzw = JAK.Compress.LZW(bytes, {maxBits:8});
			assertEquals("LZW with 8bit output - length", bytes.length, lzw.length);
			var ilzw = JAK.Compress.iLZW(lzw, {maxBits:8});
			var result = JAK.Compress.bytesToString(ilzw);
			assertEquals("LZW with 8bit output", data, result);

			var data = createTestData(0, 256);
			var bytes = JAK.Compress.stringToBytes(data);
			var lzw = JAK.Compress.LZW(bytes, {maxBits:12});
			var ilzw = JAK.Compress.iLZW(lzw, {maxBits:12});
			var result = JAK.Compress.bytesToString(ilzw);
			assertEquals("LZW with 12bit output", data, result);
		}

		</script>
	</head>
	<body>
	</body>
</html>
